% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/routines.R
\name{HMLE_TVC}
\alias{HMLE_TVC}
\title{Maximum Likelihood Estimation for Parametric Hazard Models with Time-Varying Covariates}
\usage{
HMLE_TVC(
  init,
  df,
  status,
  hstr = NULL,
  dist = NULL,
  des = NULL,
  method = "Nelder-Mead",
  maxit = 100
)
}
\arguments{
\item{df}{A data frame in **long format**, containing one row per individual per
covariate-measurement time. Required columns:

* `ID` — individual identifier
* `time` — time at which the covariates are measured
* `status` — event indicator (1 = event at the final time; 0 = censored)
* `des*` — covariate columns used in the model (e.g., `des1`, `des2`, …)

The last row for each ID represents the individual's event/censoring time,
even if the event time does not coincide with a measurement time.}

\item{method}{Optimisation method for the likelihood.
Either `"nlminb"` or a valid `optim()` method.}

\item{maxit}{Maximum number of optimisation iterations.}

\item{beta}{Numeric vector of regression coefficients associated with the
time-varying covariate design matrix (`des*` columns).}

\item{ae0, }{be0, ce0
Baseline hazard parameters.

* For **2-parameter** baselines, only `ae0` and `be0` are used.
* For **3-parameter** baselines, all three are used.

These parameters are passed directly to the user-supplied baseline
cumulative hazard function `chfun()`.}

\item{chfun}{A function computing the **baseline cumulative hazard**:

* 2-parameter case: `chfun(time, ae0, be0)`
* 3-parameter case: `chfun(time, ae0, be0, ce0)`

The function must return a vector of values of equal length to `time`.}
}
\value{
A list containing:

* The full output from `optim()` or `nlminb()`
* The **negative log-likelihood function** used for optimisation
* A vector giving, for each ID, the cumulative hazard increments used in the likelihood

Returned invisibly where appropriate.
}
\description{
`HMLE_TVC()` fits parametric survival models in the presence of
**time-varying covariates**, using maximum likelihood estimation.

The function supports:

* **Proportional Hazards (PH)** models with time-varying covariates
* Fully parametric baseline hazards (2-parameter or 3-parameter)

The likelihood is constructed from the cumulative hazard differences across
observation intervals for each individual, using a counting-process representation.

For each individual, the data must contain several rows:
one per time-varying covariate measurement, along with the corresponding time.
}
\details{
## Likelihood formulation

For each individual \(i\), let
\(t_{i1} < t_{i2} < \cdots < t_{iK_i}\)
denote the *observation / measurement times*.

The cumulative hazard contribution over interval \((t_{ij-1}, t_{ij})\) is:

\deqn{
\Delta H_{ij}
  = \left[ H_0(t_{ij}) - H_0(t_{ij-1}) \right]
    \exp(x_{ij}^\top \beta),
}

where \(x_{ij}\) is the vector of covariates measured at time \(t_{ij}\).

The full log-likelihood is:

\deqn{
\ell = \sum_i \left(
  - \sum_j \Delta H_{ij}
  + \delta_i \log \left[
       h_0(T_i) \exp(x_{iK}^\top \beta)
    \right]
\right),
}

where:

* \(\Delta H_{ij}\) comes from cumulative hazard increments
* \(T_i = t_{iK}\) is the final event or censoring time
* \(\delta_i\) is the event indicator
* hazard and cumulative hazard are computed from `chfun()`

The function internally:
1. Splits the data by ID
2. Computes cumulative hazard at all measurement times
3. Computes increments \(\Delta H_{ij}\) for each ID
4. Constructs the likelihood
5. Optimises over \(\beta\) and baseline parameters
}
\section{Data structure}{

The input data frame must contain:

* varying number of rows per ID
* strictly increasing `time` within each ID
* last row containing the event/censoring time

Covariates must be named as `des1`, `des2`, etc.
}

